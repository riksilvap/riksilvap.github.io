<p>
  <button class="btn btn-lg btn-default" onclick="readBatteryLevel()">Read Bluetooth device's battery level</button>
</p>

<p id="target"></p>

<script type="text/javascript">
  function readBatteryLevel() {
    var $target = document.getElementById('target');

    if (!('bluetooth' in navigator)) {
      $target.innerText = 'Bluetooth API not supported.';
      return;
    }

    navigator.bluetooth.requestDevice({
        acceptAllDevices: true,
        optionalServices: ['battery_service']
    })
      .then(function (device) {
        log('Getting Descriptors...');
        return device.gatt.connect();
      })
      .then(descriptor => {
        let encoder = new TextEncoder('utf-8');
        let userDescription = encoder.encode('Defines the time between measurements.');
        return descriptor.writeValue(userDescription);
      })
      .then(function (server) {
        //return server.getPrimaryService('battery_service');
      })
      .then(function (service) {
        //return service.getCharacteristic('battery_level');
      })
      .then(function (characteristic) {
        //return characteristic.readValue();
      })
      .then(function (value) {
        //$target.innerHTML = 'Battery percentage is <b>' + value.getUint8(0) + '</b>.';
      })
      .catch(function (error) {
        $target.innerText = 'Error' + error;
      });
  }
</script>
